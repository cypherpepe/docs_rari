---
TODO:
- rewrite this PoS
- check addresses for Solana and Near
---

# Bridge Protocol Contracts

Rarimo decentralized bridge contract is responsible for managing deposits and withdrawals for native, fungible and non-fungible tokens. All withdrawal operations are protected by ECDSA secp256k1 threshold (t-n) signature.

## Deployments

### Mainnet

| Network (Link) | ChainId | Address |
| --- | --- | --- |
| Ethereum ([Etherscan](https://etherscan.io/address/0xF663a9EaC9CB9Fa3eC6f1d8a4E5716a41A1752b6)) | `1` | `0xF663a9EaC9CB9Fa3eC6f1d8a4E5716a41A1752b6` |
| Polygon ([Polygonscan](https://polygonscan.com/address/0xECd1A7BdE5234d7FE50F1c0d99Fb66A7bbc10Df2)) | `137` | `0xECd1A7BdE5234d7FE50F1c0d99Fb66A7bbc10Df2` |
| Avalanche ([Avascan](https://avascan.info/blockchain/all/address/0x5608DA4bD339A57E770ff74284c2aB93EFAcAe03)) | `43114` | `0x5608DA4bD339A57E770ff74284c2aB93EFAcAe03` |
| Solana | ðŸš« | coming later |
| NEAR | ðŸš« | coming later|
| Binance Smart Chain ([BscScan](https://bscscan.com/address/0xF663a9EaC9CB9Fa3eC6f1d8a4E5716a41A1752b6)) | `56` | `0xF663a9EaC9CB9Fa3eC6f1d8a4E5716a41A1752b6` |

### Testnet

| Network (Link) | ChainId | Address |
| --- | --- | --- |
| GÃ¶rli ([Etherscan](https://goerli.etherscan.io/address/0x6EA0C45bAC29a2A2769ec14f4BCD959b07780106)) | `5` | `0x6EA0C45bAC29a2A2769ec14f4BCD959b07780106` |
| Sepolia ([Etherscan](https://sepolia.etherscan.io/address/0x300f5Ee2409c999eBA1BfdaDb4cF5D16a45500Ac)) | `11155111` | `0x300f5Ee2409c999eBA1BfdaDb4cF5D16a45500Ac` |
| Mumbai ([Polygonscan](https://mumbai.polygonscan.com/address/0xa651EdBbF77e1A2678DEfaE08A33c5004b491457)) | `80001` | `0xa651EdBbF77e1A2678DEfaE08A33c5004b491457` |
| Fuji ([Avascan](https://testnet.avascan.info/blockchain/all/address/0x02e719d3a5030e95283923c00dbccf3c745740e8)) | `43113` | `0x02e719d3a5030e95283923c00dbccf3c745740e8` |
| Solana DevNet | ðŸš« | coming soon |
| NEAR DevNet | ðŸš« | coming soon |
| Binance Testnet ([BscScan](https://testnet.bscscan.com/address/0xe48F562E01C909c17cb4BF0304C5Cb07A5158603)) | `97` | `0xe48F562E01C909c17cb4BF0304C5Cb07A5158603` |


## Signed content format

Common transfer hash can be derived from the following sequence:
```
tokenAddress | tokenName | tokenId | uri | amount | imageUri | imageHash | tokenSymbol | tokenDecimals | salt | bundle | originHash | chainName | receiver | targetBridgeContractAddress
```

OriginHash is a hash of `tx | eventId | current network`.
Some parameters can be empty.

The bridge currently supports the following token types: Native / ERC20 / ERC721 / ERC1155 / MetaplexFT / MetaplexNFT / NearFT / NearNFT

## Smart contract requirements

- Smart-contract should store ECDSA t-n public key
- Changing of stored admins key requires t-n signature of the new key produced by the old key
- Withdrawal operations should accept Merkle node content, Merkle path, and admin t-n signature for Merkle root.
- Withdrawal operations should perform a check for Merkle path, signature, and other sensitive stuff

## Bridging flow

1. User wants to transfer the token from the current chain to the target one. For this, user submits a deposit transaction to the current chain bridge smart-contract.
2. Any other external services (or users by themselves) submit deposit information into the core service. Core service performs transaction validation before adding them to the ledger.
3. External services (signature producers) observe new operations in the core state and add them to the local pool.
4. Signature producers combine deposits into the Merkle tree, produce the threshold signature, and submit that info to the core. Core service performs the Merkle tree data and signature validation before adding it to the ledger.
5. After signed deposit information appears in the core state it becomes possible to call the withdrawal operation on the target network.
6. Smart-contract on the target network validates information about the deposit, Merkle path, and signature for the Merkle root, and performs a token withdrawal.
