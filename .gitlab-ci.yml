default:
  image: node:18.12.0
  tags:
  - "tokend"

stages:
- test
- deploy

test:
  stage: test
  script:
  - yarn install --frozen-lockfile
  - yarn lint
  - yarn typecheck
  rules:
  - if: $CI_PIPELINE_SOURCE == 'merge_request_event'


deploy:
  stage: deploy
  script:
  - yarn install --frozen-lockfile --production
  - yarn build
  - mv ./build ./public
  artifacts:
    paths:
    - public
  rules:
  - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH
